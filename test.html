<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­è‹±æ–‡ç¿»è¯‘ç»ƒä¹ å·¥å…· - ä¿®å¤URLåŠ è½½é—®é¢˜</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>
    <style>
        /* ä¿æŒä¹‹å‰çš„æ ·å¼ä¸å˜ï¼Œåªæ·»åŠ å¿…è¦çš„ä¿®æ­£ */
        .url-test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .url-test-success {
            background-color: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        
        .url-test-error {
            background-color: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        
        .url-test-warning {
            background-color: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }
        
        .test-url-btn {
            background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            font-size: 0.9rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .test-url-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(139, 92, 246, 0.3);
        }
        
        .url-info {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 8px;
            line-height: 1.4;
        }
        
        .url-info a {
            color: #3b82f6;
            text-decoration: none;
        }
        
        .url-info a:hover {
            text-decoration: underline;
        }
        
        .direct-link-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f9ff;
            border-radius: 8px;
            border-left: 4px solid #0ea5e9;
        }
        
        .direct-link-title {
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .direct-link-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .direct-link-btn {
            display: block;
            width: 100%;
            padding: 10px 15px;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
        }
        
        .direct-link-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3);
        }
        
        .direct-link-btn.example {
            background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ä¸­è‹±æ–‡ç¿»è¯‘ç»ƒä¹ å·¥å…·</h1>
            <p class="subtitle">æ”¯æŒåŠ å¯†Excelæ–‡ä»¶ï¼Œä»æœåŠ¡å™¨æˆ–æœ¬åœ°ä¸Šä¼ æ–‡ä»¶ï¼Œç»ƒä¹ ä¸­æ–‡åˆ°è‹±æ–‡ç¿»è¯‘</p>
        </header>
        
        <div class="main-content">
            <!-- æ•°æ®æºé€‰æ‹©åŒºåŸŸ -->
            <div class="section">
                <h2 class="section-title">
                    <span>ğŸ“</span> ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©æ•°æ®æº
                </h2>
                
                <div class="mode-selector">
                    <button class="mode-btn active" id="uploadModeBtn">ä¸Šä¼ æœ¬åœ°Excelæ–‡ä»¶</button>
                    <button class="mode-btn" id="urlModeBtn">ä»æœåŠ¡å™¨URLåŠ è½½</button>
                </div>
                
                <!-- ä¸Šä¼ æ¨¡å¼ -->
                <div class="mode-content active" id="uploadMode">
                    <div class="file-upload-area" id="uploadArea">
                        <div class="upload-icon">ğŸ“„</div>
                        <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½Excelæ–‡ä»¶åˆ°æ­¤åŒºåŸŸ</p>
                        <p class="upload-hint">æ–‡ä»¶æ ¼å¼ï¼š.xlsx æˆ– .xlsï¼Œç¬¬ä¸€åˆ—ä¸ºä¸­æ–‡ï¼Œç¬¬äºŒåˆ—ä¸ºè‹±æ–‡ç¿»è¯‘</p>
                        <button class="upload-btn" id="uploadBtn">é€‰æ‹©Excelæ–‡ä»¶</button>
                        <input type="file" id="fileInput" accept=".xlsx,.xls,.xlsm">
                    </div>
                    
                    <div class="password-input-area">
                        <div class="password-input-group">
                            <label class="password-label" for="filePassword">Excelæ–‡ä»¶å¯†ç ï¼ˆå¦‚æœæ²¡æœ‰å¯†ç ï¼Œè¯·ç•™ç©ºï¼‰</label>
                            <input type="password" id="filePassword" class="password-input" placeholder="è¾“å…¥Excelæ–‡ä»¶å¯†ç ï¼ˆå¯é€‰ï¼‰">
                            <p class="password-hint">å¦‚æœæ‚¨çš„Excelæ–‡ä»¶æœ‰å¯†ç ä¿æŠ¤ï¼Œè¯·åœ¨æ­¤è¾“å…¥å¯†ç ã€‚å¦‚æœæ²¡æœ‰å¯†ç ï¼Œè¯·ç•™ç©ºã€‚</p>
                        </div>
                    </div>
                </div>
                
                <!-- URLæ¨¡å¼ -->
                <div class="mode-content" id="urlMode">
                    <div class="url-input-area">
                        <p class="upload-text">è¾“å…¥æœåŠ¡å™¨ä¸ŠExcelæ–‡ä»¶çš„URLï¼š</p>
                        <div class="url-input-group">
                            <input type="text" id="serverUrl" placeholder="https://example.com/path/to/your/file.xlsx" 
                                   value="https://joeyking911.github.io/test.xlsx">
                            <button class="load-btn" id="loadUrlBtn">åŠ è½½æ–‡ä»¶</button>
                            <button class="test-url-btn" id="testUrlBtn">æµ‹è¯•URL</button>
                        </div>
                        
                        <div id="urlTestResult" class="url-test-result"></div>
                        
                        <div class="url-info">
                            <p><strong>URLæ ¼å¼æç¤ºï¼š</strong></p>
                            <ul>
                                <li>ç¡®ä¿URLç›´æ¥æŒ‡å‘Excelæ–‡ä»¶ï¼ˆä»¥.xlsxã€.xlsæˆ–.xlsmç»“å°¾ï¼‰</li>
                                <li>Google Sheetsæ–‡ä»¶ï¼šéœ€è¦å‘å¸ƒä¸º"ä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹"ï¼Œç„¶åä½¿ç”¨"æ–‡ä»¶ â†’ å‘å¸ƒåˆ°ç½‘é¡µ â†’ é€‰æ‹©.xlsxæ ¼å¼"è·å–é“¾æ¥</li>
                                <li>OneDrive/SharePointæ–‡ä»¶ï¼šéœ€è¦è·å–ç›´æ¥ä¸‹è½½é“¾æ¥ï¼Œé€šå¸¸åŒ…å«"download=1"å‚æ•°</li>
                                <li>Dropboxæ–‡ä»¶ï¼šå°†é“¾æ¥ä¸­çš„"www.dropbox.com"æ”¹ä¸º"dl.dropboxusercontent.com"</li>
                                <li>GitHubæ–‡ä»¶ï¼šä½¿ç”¨åŸå§‹æ–‡ä»¶é“¾æ¥ï¼ˆraw.githubusercontent.comï¼‰</li>
                            </ul>
                        </div>
                        
                        <div class="password-input-area">
                            <div class="password-input-group">
                                <label class="password-label" for="urlPassword">Excelæ–‡ä»¶å¯†ç ï¼ˆå¦‚æœæ²¡æœ‰å¯†ç ï¼Œè¯·ç•™ç©ºï¼‰</label>
                                <input type="password" id="urlPassword" class="password-input" placeholder="è¾“å…¥Excelæ–‡ä»¶å¯†ç ï¼ˆå¯é€‰ï¼‰">
                                <p class="password-hint">å¦‚æœæ‚¨çš„Excelæ–‡ä»¶æœ‰å¯†ç ä¿æŠ¤ï¼Œè¯·åœ¨æ­¤è¾“å…¥å¯†ç ã€‚å¦‚æœæ²¡æœ‰å¯†ç ï¼Œè¯·ç•™ç©ºã€‚</p>
                            </div>
                        </div>
                        
                        <div class="direct-link-section">
                            <div class="direct-link-title">
                                <span>ğŸ”—</span> å¿«é€Ÿé“¾æ¥
                            </div>
                            <p style="margin-bottom: 10px; color: #4b5563; font-size: 0.9rem;">
                                ç‚¹å‡»ä»¥ä¸‹é“¾æ¥ä½¿ç”¨ç¤ºä¾‹Excelæ–‡ä»¶ï¼š
                            </p>
                            <div class="direct-link-list">
                                <button class="direct-link-btn example" id="exampleExcelUrl1">
                                    ç¤ºä¾‹1ï¼šåŸºç¡€ä¸­è‹±æ–‡ç¿»è¯‘ç»ƒä¹ 
                                </button>
                                <button class="direct-link-btn example" id="exampleExcelUrl2">
                                    ç¤ºä¾‹2ï¼šå•†åŠ¡è‹±è¯­ç¿»è¯‘ç»ƒä¹ 
                                </button>
                                <button class="direct-link-btn example" id="exampleExcelUrl3">
                                    ç¤ºä¾‹3ï¼šæ—¥å¸¸å¯¹è¯ç¿»è¯‘ç»ƒä¹ 
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ç¤ºä¾‹æ•°æ® -->
                <button class="example-data-btn" id="exampleDataBtn">ä½¿ç”¨ç¤ºä¾‹æ•°æ®å¼€å§‹ç»ƒä¹ ï¼ˆæ— éœ€æ–‡ä»¶ï¼‰</button>
                
                <div class="file-info" id="fileInfo"></div>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åŠ è½½Excelæ–‡ä»¶ï¼Œè¯·ç¨å€™...</p>
                </div>
                <div class="error-message" id="errorMessage"></div>
            </div>
            
            <!-- ç¿»è¯‘ç»ƒä¹ åŒºåŸŸ -->
            <div class="section translation-area" id="translationArea">
                <h2 class="section-title">
                    <span>ğŸ”¤</span> ç¬¬äºŒæ­¥ï¼šç¿»è¯‘ç»ƒä¹ 
                </h2>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span>è¿›åº¦: <span id="currentIndex">0</span>/<span id="totalSentences">0</span></span>
                        <span>å¾—åˆ†: <span id="score">0</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
                
                <div class="current-sentence" id="currentSentence">
                    è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶æˆ–ä»æœåŠ¡å™¨åŠ è½½
                </div>
                
                <div class="translation-input-container">
                    <label class="input-label" for="translationInput">è¯·è¾“å…¥è‹±æ–‡ç¿»è¯‘ï¼š</label>
                    <textarea id="translationInput" rows="3" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„è‹±æ–‡ç¿»è¯‘..."></textarea>
                    
                    <div class="button-group">
                        <button class="action-btn submit-btn" id="submitBtn">æäº¤ç¿»è¯‘</button>
                        <button class="action-btn next-btn" id="nextBtn">ä¸‹ä¸€ä¸ªå¥å­</button>
                    </div>
                </div>
                
                <div class="result-area" id="resultArea">
                    <!-- ç»“æœä¼šåŠ¨æ€æ˜¾ç¤º -->
                </div>
            </div>
            
            <!-- ç»“æœæ€»ç»“ -->
            <div class="results-summary" id="resultsSummary">
                <h2 class="section-title">ç»ƒä¹ å®Œæˆï¼</h2>
                <div class="score-display" id="finalScore">0%</div>
                <p class="score-text" id="scoreText">æ‚¨çš„ç¿»è¯‘å¾—åˆ†</p>
                
                <div class="stats">
                    <div class="stat correct-stat">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">æ­£ç¡®</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">æ€»è®¡</div>
                    </div>
                    <div class="stat incorrect-stat">
                        <div class="stat-value" id="incorrectCount">0</div>
                        <div class="stat-label">é”™è¯¯</div>
                    </div>
                </div>
                
                <button class="restart-btn" id="restartBtn">é‡æ–°å¼€å§‹ç»ƒä¹ </button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let chineseSentences = [];
        let englishAnswers = [];
        let currentIndex = 0;
        let score = 0;
        let results = [];
        let dataSource = '';
        
        // DOMå…ƒç´ 
        const uploadModeBtn = document.getElementById('uploadModeBtn');
        const urlModeBtn = document.getElementById('urlModeBtn');
        const uploadMode = document.getElementById('uploadMode');
        const urlMode = document.getElementById('urlMode');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const filePasswordInput = document.getElementById('filePassword');
        const urlPasswordInput = document.getElementById('urlPassword');
        const serverUrlInput = document.getElementById('serverUrl');
        const loadUrlBtn = document.getElementById('loadUrlBtn');
        const testUrlBtn = document.getElementById('testUrlBtn');
        const urlTestResult = document.getElementById('urlTestResult');
        const exampleExcelUrl1 = document.getElementById('exampleExcelUrl1');
        const exampleExcelUrl2 = document.getElementById('exampleExcelUrl2');
        const exampleExcelUrl3 = document.getElementById('exampleExcelUrl3');
        const exampleDataBtn = document.getElementById('exampleDataBtn');
        const fileInfo = document.getElementById('fileInfo');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const translationArea = document.getElementById('translationArea');
        const currentSentence = document.getElementById('currentSentence');
        const translationInput = document.getElementById('translationInput');
        const submitBtn = document.getElementById('submitBtn');
        const nextBtn = document.getElementById('nextBtn');
        const resultArea = document.getElementById('resultArea');
        const progressFill = document.getElementById('progressFill');
        const currentIndexElement = document.getElementById('currentIndex');
        const totalSentencesElement = document.getElementById('totalSentences');
        const scoreElement = document.getElementById('score');
        const resultsSummary = document.getElementById('resultsSummary');
        const finalScore = document.getElementById('finalScore');
        const correctCount = document.getElementById('correctCount');
        const incorrectCount = document.getElementById('incorrectCount');
        const totalCount = document.getElementById('totalCount');
        const scoreText = document.getElementById('scoreText');
        const restartBtn = document.getElementById('restartBtn');
        const uploadBtn = document.getElementById('uploadBtn');
        
        // æ¨¡å¼åˆ‡æ¢
        uploadModeBtn.addEventListener('click', () => {
            uploadModeBtn.classList.add('active');
            urlModeBtn.classList.remove('active');
            uploadMode.classList.add('active');
            urlMode.classList.remove('active');
        });
        
        urlModeBtn.addEventListener('click', () => {
            urlModeBtn.classList.add('active');
            uploadModeBtn.classList.remove('active');
            urlMode.classList.add('active');
            uploadMode.classList.remove('active');
        });
        
        // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadBtn.addEventListener('click', () => fileInput.click());
        
        // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (e.dataTransfer.files.length) {
                const file = e.dataTransfer.files[0];
                if (file.name.match(/\.(xlsx|xls|xlsm)$/)) {
                    dataSource = `ä¸Šä¼ æ–‡ä»¶: ${file.name}`;
                    processExcelFile(file);
                } else {
                    showError('è¯·ä¸Šä¼ Excelæ–‡ä»¶ (.xlsx, .xls æˆ– .xlsm æ ¼å¼)');
                }
            }
        });
        
        // æ–‡ä»¶é€‰æ‹©å˜åŒ–
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                const file = e.target.files[0];
                dataSource = `ä¸Šä¼ æ–‡ä»¶: ${file.name}`;
                processExcelFile(file);
            }
        });
        
        // æµ‹è¯•URLåŠŸèƒ½
        testUrlBtn.addEventListener('click', async () => {
            const url = serverUrlInput.value.trim();
            if (!url) {
                showUrlTestResult('è¯·è¾“å…¥URLè¿›è¡Œæµ‹è¯•', 'error');
                return;
            }
            
            showUrlTestResult('æ­£åœ¨æµ‹è¯•URLè¿æ¥...', 'warning');
            
            try {
                const response = await fetch(url, { method: 'HEAD' });
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type') || '';
                    const contentLength = response.headers.get('content-length') || 'æœªçŸ¥';
                    const filename = url.substring(url.lastIndexOf('/') + 1);
                    
                    let resultHtml = `
                        <strong>âœ… URLæµ‹è¯•æˆåŠŸï¼</strong><br>
                        æ–‡ä»¶: ${filename}<br>
                        å†…å®¹ç±»å‹: ${contentType}<br>
                        æ–‡ä»¶å¤§å°: ${formatFileSize(contentLength)}<br>
                        çŠ¶æ€: ${response.status} ${response.statusText}
                    `;
                    
                    if (contentType.includes('application/vnd.openxmlformats-officedocument') || 
                        contentType.includes('application/vnd.ms-excel') ||
                        url.match(/\.(xlsx|xls|xlsm)$/)) {
                        resultHtml += '<br>âœ… æ£€æµ‹åˆ°Excelæ–‡ä»¶ç±»å‹';
                    } else {
                        resultHtml += '<br>âš ï¸ æ³¨æ„: å†…å®¹ç±»å‹å¯èƒ½ä¸æ˜¯æ ‡å‡†çš„Excelæ–‡ä»¶';
                    }
                    
                    showUrlTestResult(resultHtml, 'success');
                } else {
                    showUrlTestResult(`
                        <strong>âŒ URLæµ‹è¯•å¤±è´¥</strong><br>
                        çŠ¶æ€: ${response.status} ${response.statusText}<br>
                        å¯èƒ½çš„åŸå› :<br>
                        1. æ–‡ä»¶ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤<br>
                        2. éœ€è¦ç™»å½•æˆ–æƒé™éªŒè¯<br>
                        3. æœåŠ¡å™¨æ‹’ç»äº†è¯·æ±‚
                    `, 'error');
                }
            } catch (error) {
                console.error('æµ‹è¯•URLæ—¶å‡ºé”™:', error);
                showUrlTestResult(`
                    <strong>âŒ URLæµ‹è¯•å¤±è´¥</strong><br>
                    é”™è¯¯: ${error.message}<br>
                    å¯èƒ½çš„åŸå› :<br>
                    1. ç½‘ç»œè¿æ¥é—®é¢˜<br>
                    2. CORSé™åˆ¶ï¼ˆè·¨åŸŸé—®é¢˜ï¼‰<br>
                    3. URLæ ¼å¼ä¸æ­£ç¡®
                `, 'error');
            }
        });
        
        // ä»URLåŠ è½½Excelæ–‡ä»¶
        loadUrlBtn.addEventListener('click', () => {
            const url = serverUrlInput.value.trim();
            if (!url) {
                showError('è¯·è¾“å…¥Excelæ–‡ä»¶çš„URL');
                return;
            }
            
            dataSource = `æœåŠ¡å™¨æ–‡ä»¶: ${url}`;
            loadExcelFromUrl(url);
        });
        
        // ç¤ºä¾‹Excelæ–‡ä»¶URL
        exampleExcelUrl1.addEventListener('click', () => {
            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ç¤ºä¾‹Excelæ–‡ä»¶
            createExampleExcelFile('åŸºç¡€ä¸­è‹±æ–‡ç¿»è¯‘ç»ƒä¹ ');
        });
        
        exampleExcelUrl2.addEventListener('click', () => {
            createExampleExcelFile('å•†åŠ¡è‹±è¯­ç¿»è¯‘ç»ƒä¹ ');
        });
        
        exampleExcelUrl3.addEventListener('click', () => {
            createExampleExcelFile('æ—¥å¸¸å¯¹è¯ç¿»è¯‘ç»ƒä¹ ');
        });
        
        // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
        exampleDataBtn.addEventListener('click', () => {
            dataSource = 'ç¤ºä¾‹æ•°æ®';
            useExampleData();
        });
        
        // ä»URLåŠ è½½Excelæ–‡ä»¶
        async function loadExcelFromUrl(url) {
            showLoading(true);
            hideError();
            fileInfo.style.display = 'none';
            urlTestResult.style.display = 'none';
            
            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);
                }
                
                // æ£€æŸ¥å“åº”ç±»å‹
                const contentType = response.headers.get('content-type') || '';
                const arrayBuffer = await response.arrayBuffer();
                
                // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºæœ‰æ•ˆçš„Excel/ZIPæ–‡ä»¶
                if (arrayBuffer.byteLength === 0) {
                    throw new Error('ä¸‹è½½çš„æ–‡ä»¶ä¸ºç©ºï¼Œè¯·æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®');
                }
                
                // æ£€æŸ¥æ–‡ä»¶å¤´æ˜¯å¦ä¸ºZIPæ ¼å¼ (Excelæ–‡ä»¶æ˜¯ZIPæ ¼å¼)
                const header = new Uint8Array(arrayBuffer.slice(0, 4));
                const isZipFile = header[0] === 0x50 && header[1] === 0x4B; // PK (ZIPæ–‡ä»¶å¤´)
                
                if (!isZipFile) {
                    // å°è¯•æ£€æŸ¥æ˜¯å¦ä¸ºè€å¼.xlsæ–‡ä»¶
                    const isXlsFile = header[0] === 0xD0 && header[1] === 0xCF && 
                                     header[2] === 0x11 && header[3] === 0xE0;
                    
                    if (!isXlsFile) {
                        // æ£€æŸ¥æ˜¯å¦ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼ˆå¯èƒ½æ˜¯HTMLé”™è¯¯é¡µé¢ï¼‰
                        const textDecoder = new TextDecoder('utf-8');
                        const firstBytes = textDecoder.decode(arrayBuffer.slice(0, 100));
                        
                        if (firstBytes.includes('<html') || firstBytes.includes('<!DOCTYPE')) {
                            throw new Error('URLè¿”å›çš„æ˜¯HTMLé¡µé¢ï¼Œè€Œä¸æ˜¯Excelæ–‡ä»¶ã€‚å¯èƒ½æ˜¯ç™»å½•é¡µé¢æˆ–é”™è¯¯é¡µé¢ã€‚');
                        } else if (firstBytes.includes('error') || firstBytes.includes('Error')) {
                            throw new Error('æœåŠ¡å™¨è¿”å›äº†é”™è¯¯é¡µé¢');
                        } else {
                            throw new Error('ä¸‹è½½çš„æ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆçš„Excelæ–‡ä»¶ã€‚è¯·ç¡®ä¿URLç›´æ¥æŒ‡å‘Excelæ–‡ä»¶ã€‚');
                        }
                    }
                }
                
                const password = urlPasswordInput.value;
                await processExcelData(arrayBuffer, url, password);
            } catch (error) {
                console.error('åŠ è½½Excelæ–‡ä»¶æ—¶å‡ºé”™:', error);
                showLoading(false);
                
                let errorDetails = `
                    <strong>åŠ è½½å¤±è´¥:</strong> ${error.message}<br><br>
                    <strong>å¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ:</strong><br>
                    1. <strong>URLä¸æ­£ç¡®</strong> - ç¡®ä¿URLç›´æ¥æŒ‡å‘Excelæ–‡ä»¶<br>
                    2. <strong>éœ€è¦ç™»å½•</strong> - æŸäº›ç½‘ç«™éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®æ–‡ä»¶<br>
                    3. <strong>CORSé™åˆ¶</strong> - æœåŠ¡å™¨å¯èƒ½ä¸å…è®¸è·¨åŸŸè®¿é—®<br>
                    4. <strong>æ–‡ä»¶ä¸å­˜åœ¨</strong> - æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®<br><br>
                    <strong>å»ºè®®:</strong><br>
                    â€¢ ç‚¹å‡»"æµ‹è¯•URL"æŒ‰é’®æ£€æŸ¥URLæ˜¯å¦æœ‰æ•ˆ<br>
                    â€¢ å°è¯•ä¸‹è½½æ–‡ä»¶åä½¿ç”¨"ä¸Šä¼ æœ¬åœ°æ–‡ä»¶"åŠŸèƒ½<br>
                    â€¢ ä½¿ç”¨ç¤ºä¾‹æ•°æ®ç«‹å³å¼€å§‹ç»ƒä¹ 
                `;
                
                showError(errorDetails);
            }
        }
        
        // å¤„ç†Excelæ–‡ä»¶ï¼ˆä¸Šä¼ æ¨¡å¼ï¼‰
        function processExcelFile(file) {
            showLoading(true);
            hideError();
            fileInfo.style.display = 'none';
            
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const password = filePasswordInput.value;
                    await processExcelData(e.target.result, file.name, password);
                } catch (error) {
                    showLoading(false);
                    showError(`å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: ${error.message}`);
                }
            };
            
            reader.onerror = function() {
                showLoading(false);
                showError('è¯»å–æ–‡ä»¶æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å®Œæ•´ä¸”å¯è®¿é—®ã€‚');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // å¤„ç†Excelæ•°æ®ï¼ˆé€šç”¨å‡½æ•°ï¼‰
        async function processExcelData(data, sourceName, password) {
            try {
                // æ¸…ç©ºä¹‹å‰çš„æ•°æ®
                chineseSentences = [];
                englishAnswers = [];
                
                let processed = false;
                
                // é¦–å…ˆå°è¯•ä½¿ç”¨ExcelJSï¼ˆæ”¯æŒåŠ å¯†æ–‡ä»¶ï¼‰
                if (typeof ExcelJS !== 'undefined') {
                    try {
                        await processWithExcelJS(data, password);
                        processed = true;
                    } catch (excelJSError) {
                        console.log('ExcelJSå¤„ç†å¤±è´¥:', excelJSError.message);
                        // ç»§ç»­å°è¯•XLSX
                    }
                }
                
                // å¦‚æœExcelJSå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨XLSX
                if (!processed && typeof XLSX !== 'undefined') {
                    try {
                        processWithXLSX(data);
                        processed = true;
                    } catch (xlsxError) {
                        console.log('XLSXå¤„ç†å¤±è´¥:', xlsxError.message);
                        // å¦‚æœä¸¤ç§æ–¹æ³•éƒ½å¤±è´¥ï¼ŒæŠ›å‡ºé”™è¯¯
                        throw new Error('æ— æ³•è§£æExcelæ–‡ä»¶ã€‚è¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸåæˆ–ä½¿ç”¨äº†ä¸æ”¯æŒçš„æ ¼å¼ã€‚');
                    }
                }
                
                if (!processed) {
                    throw new Error('æ²¡æœ‰å¯ç”¨çš„Excelè§£æåº“ã€‚è¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚');
                }
                
                // æ£€æŸ¥æ˜¯å¦æˆåŠŸæå–æ•°æ®
                if (chineseSentences.length === 0) {
                    throw new Error('æ²¡æœ‰åœ¨Excelæ–‡ä»¶çš„Aåˆ—æ‰¾åˆ°ä¸­æ–‡å¥å­ã€‚è¯·ç¡®ä¿ç¬¬ä¸€åˆ—æ˜¯ä¸­æ–‡å¥å­ï¼Œä¸”æ•°æ®ä»ç¬¬ä¸€è¡Œå¼€å§‹ã€‚');
                }
                
                // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                showLoading(false);
                fileInfo.innerHTML = `
                    <strong>âœ… æ•°æ®åŠ è½½æˆåŠŸï¼</strong><br>
                    æ¥æº: ${dataSource}<br>
                    æ‰¾åˆ° ${chineseSentences.length} ä¸ªä¸­æ–‡å¥å­<br>
                    ${password ? 'å·²ä½¿ç”¨å¯†ç è§£å¯†' : 'æ–‡ä»¶æœªåŠ å¯†'}
                `;
                fileInfo.style.display = 'block';
                fileInfo.style.backgroundColor = '#e6f7ff';
                fileInfo.style.borderLeftColor = '#1890ff';
                
                // é‡ç½®ç»ƒä¹ çŠ¶æ€
                currentIndex = 0;
                score = 0;
                results = [];
                
                // æ˜¾ç¤ºç¿»è¯‘åŒºåŸŸ
                translationArea.style.display = 'block';
                resultArea.style.display = 'none';
                resultsSummary.style.display = 'none';
                
                // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                updateProgress();
                
                // æ˜¾ç¤ºç¬¬ä¸€ä¸ªå¥å­
                showCurrentSentence();
                
            } catch (error) {
                console.error('è§£æExcelæ–‡ä»¶æ—¶å‡ºé”™:', error);
                showLoading(false);
                
                let errorMsg = `
                    <strong>è§£æExcelæ–‡ä»¶æ—¶å‡ºé”™:</strong> ${error.message}<br><br>
                `;
                
                if (error.message.includes('password') || error.message.includes('è§£å¯†')) {
                    errorMsg += '<strong>å¯†ç ç›¸å…³é—®é¢˜:</strong><br>';
                    errorMsg += '1. å¦‚æœæ–‡ä»¶æœ‰å¯†ç ï¼Œè¯·ç¡®ä¿è¾“å…¥äº†æ­£ç¡®çš„å¯†ç <br>';
                    errorMsg += '2. å¦‚æœæ–‡ä»¶æ²¡æœ‰å¯†ç ï¼Œè¯·æ¸…ç©ºå¯†ç æ¡†<br>';
                    errorMsg += '3. æŸäº›å¤æ‚çš„åŠ å¯†å¯èƒ½ä¸æ”¯æŒåœ¨æµè§ˆå™¨ä¸­è§£å¯†<br>';
                } else if (error.message.includes('ZIP') || error.message.includes('zip')) {
                    errorMsg += '<strong>æ–‡ä»¶æ ¼å¼é—®é¢˜:</strong><br>';
                    errorMsg += '1. æ–‡ä»¶å¯èƒ½å·²æŸå<br>';
                    errorMsg += '2. æ–‡ä»¶å¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„Excelæ ¼å¼<br>';
                    errorMsg += '3. å°è¯•åœ¨Excelä¸­æ‰“å¼€æ–‡ä»¶å¹¶é‡æ–°ä¿å­˜<br>';
                }
                
                showError(errorMsg);
            }
        }
        
        // ä½¿ç”¨ExcelJSåº“å¤„ç†Excelæ–‡ä»¶ï¼ˆæ”¯æŒåŠ å¯†ï¼‰
        async function processWithExcelJS(data, password) {
            const workbook = new ExcelJS.Workbook();
            
            // å¦‚æœæä¾›äº†å¯†ç ï¼Œä½¿ç”¨å¯†ç è§£å¯†
            if (password && password.trim() !== '') {
                await workbook.xlsx.load(data, { password: password });
            } else {
                await workbook.xlsx.load(data);
            }
            
            // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
            const worksheet = workbook.worksheets[0];
            
            // éå†è¡Œæå–æ•°æ®
            worksheet.eachRow((row, rowNumber) => {
                // è·³è¿‡ç©ºè¡Œ
                if (!row.hasValues) return;
                
                const chinese = row.getCell(1).value;
                const english = row.getCell(2).value;
                
                if (chinese && chinese.toString().trim() !== '') {
                    chineseSentences.push(chinese.toString().trim());
                    englishAnswers.push(english ? english.toString().trim() : '');
                }
            });
            
            // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°è¯•ä»æ‰€æœ‰è¡Œè·å–
            if (chineseSentences.length === 0) {
                const rowCount = worksheet.rowCount;
                for (let i = 1; i <= rowCount; i++) {
                    const row = worksheet.getRow(i);
                    const chinese = row.getCell(1).value;
                    const english = row.getCell(2).value;
                    
                    if (chinese && chinese.toString().trim() !== '') {
                        chineseSentences.push(chinese.toString().trim());
                        englishAnswers.push(english ? english.toString().trim() : '');
                    }
                }
            }
        }
        
        // ä½¿ç”¨XLSXåº“å¤„ç†Excelæ–‡ä»¶
        function processWithXLSX(data) {
            const workbook = XLSX.read(data, { type: 'array' });
            
            // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            
            // å°†å·¥ä½œè¡¨è½¬æ¢ä¸ºJSON
            const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
            
            // æå–Aåˆ—å’ŒBåˆ—çš„æ•°æ®
            jsonData.forEach((row, index) => {
                if (row[0] && row[0].toString().trim() !== '') {
                    chineseSentences.push(row[0].toString().trim());
                    englishAnswers.push(row[1] ? row[1].toString().trim() : '');
                }
            });
        }
        
        // åˆ›å»ºç¤ºä¾‹Excelæ–‡ä»¶
        function createExampleExcelFile(type) {
            let sentences = [];
            let translations = [];
            
            if (type === 'åŸºç¡€ä¸­è‹±æ–‡ç¿»è¯‘ç»ƒä¹ ') {
                sentences = [
                    "ä½ å¥½ï¼Œä¸–ç•Œï¼",
                    "ä»Šå¤©çš„å¤©æ°”éå¸¸å¥½ã€‚",
                    "æˆ‘å–œæ¬¢å­¦ä¹ æ–°çš„è¯­è¨€ã€‚",
                    "äººå·¥æ™ºèƒ½æ­£åœ¨æ”¹å˜ä¸–ç•Œã€‚",
                    "å¥¹æ¯å¤©æ—©ä¸Šéƒ½å»å…¬å›­è·‘æ­¥ã€‚"
                ];
                translations = [
                    "Hello, world!",
                    "The weather is very nice today.",
                    "I like learning new languages.",
                    "Artificial intelligence is changing the world.",
                    "She goes running in the park every morning."
                ];
            } else if (type === 'å•†åŠ¡è‹±è¯­ç¿»è¯‘ç»ƒä¹ ') {
                sentences = [
                    "æˆ‘ä»¬éœ€è¦å°½å¿«å®Œæˆè¿™ä¸ªé¡¹ç›®ã€‚",
                    "è¯·å°†ä¼šè®®è®°å½•å‘é€ç»™æ‰€æœ‰å‚ä¼šäººå‘˜ã€‚",
                    "å…¬å¸çš„å¹´åº¦æŠ¥å‘Šæ˜¾ç¤ºåˆ©æ¶¦å¢é•¿äº†15%ã€‚",
                    "æˆ‘ä»¬éœ€è¦è®¨è®ºä¸‹ä¸€å­£åº¦çš„å¸‚åœºç­–ç•¥ã€‚",
                    "è¯·ç¡®ä¿åœ¨æˆªæ­¢æ—¥æœŸå‰æäº¤æŠ¥å‘Šã€‚"
                ];
                translations = [
                    "We need to complete this project as soon as possible.",
                    "Please send the meeting minutes to all participants.",
                    "The company's annual report shows a 15% increase in profit.",
                    "We need to discuss the marketing strategy for the next quarter.",
                    "Please make sure to submit the report before the deadline."
                ];
            } else if (type === 'æ—¥å¸¸å¯¹è¯ç¿»è¯‘ç»ƒä¹ ') {
                sentences = [
                    "ä½ å‘¨æœ«æœ‰ä»€ä¹ˆè®¡åˆ’ï¼Ÿ",
                    "è¿™å®¶é¤å…çš„èœéå¸¸å¥½åƒã€‚",
                    "æˆ‘æ˜¨å¤©çœ‹äº†ä¸€éƒ¨å¾ˆæœ‰è¶£çš„ç”µå½±ã€‚",
                    "ä½ èƒ½å‘Šè¯‰æˆ‘æ€ä¹ˆå»ç«è½¦ç«™å—ï¼Ÿ",
                    "æˆ‘é€šå¸¸æ™šä¸Šåç‚¹å·¦å³ç¡è§‰ã€‚"
                ];
                translations = [
                    "What are your plans for the weekend?",
                    "The food at this restaurant is very delicious.",
                    "I watched a very interesting movie yesterday.",
                    "Can you tell me how to get to the train station?",
                    "I usually go to bed around 10 PM."
                ];
            }
            
            // åˆ›å»ºExcelæ•°æ®
            const wsData = [
                ["ä¸­æ–‡å¥å­", "è‹±æ–‡ç¿»è¯‘"],
                ...sentences.map((sentence, i) => [sentence, translations[i]])
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ç¿»è¯‘ç»ƒä¹ ");
            
            // ç”ŸæˆExcelæ–‡ä»¶
            const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
            const blob = new Blob([wbout], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            const url = URL.createObjectURL(blob);
            
            // ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶
            dataSource = `ç¤ºä¾‹æ–‡ä»¶: ${type}`;
            processExcelData(wbout, type, '');
            
            // æ›´æ–°URLè¾“å…¥æ¡†
            serverUrlInput.value = `${type} (ç¤ºä¾‹æ–‡ä»¶)`;
        }
        
        // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
        function useExampleData() {
            // ç¤ºä¾‹æ•°æ®
            chineseSentences = [
                "ä½ å¥½ï¼Œä¸–ç•Œï¼",
                "ä»Šå¤©çš„å¤©æ°”éå¸¸å¥½ã€‚",
                "æˆ‘å–œæ¬¢å­¦ä¹ æ–°çš„è¯­è¨€ã€‚",
                "äººå·¥æ™ºèƒ½æ­£åœ¨æ”¹å˜ä¸–ç•Œã€‚",
                "å¥¹æ¯å¤©æ—©ä¸Šéƒ½å»å…¬å›­è·‘æ­¥ã€‚",
                "è¿™ä¸ªé¡¹ç›®å°†åœ¨ä¸‹ä¸ªæœˆå®Œæˆã€‚",
                "è¯·æŠŠç›é€’ç»™æˆ‘ã€‚",
                "ä»–æ˜¯ä¸€ä½éå¸¸æœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆã€‚",
                "æˆ‘ä»¬è®¡åˆ’æ˜å¹´å»æ—¥æœ¬æ—…è¡Œã€‚",
                "è¿™ä¸ªé—®é¢˜æ¯”æˆ‘æƒ³è±¡çš„è¦å¤æ‚ã€‚"
            ];
            
            englishAnswers = [
                "Hello, world!",
                "The weather is very nice today.",
                "I like learning new languages.",
                "Artificial intelligence is changing the world.",
                "She goes running in the park every morning.",
                "This project will be completed next month.",
                "Please pass me the salt.",
                "He is a very experienced engineer.",
                "We plan to travel to Japan next year.",
                "This problem is more complicated than I thought."
            ];
            
            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            fileInfo.innerHTML = `
                <strong>âœ… ç¤ºä¾‹æ•°æ®åŠ è½½æˆåŠŸï¼</strong><br>
                æ¥æº: ${dataSource}<br>
                æ‰¾åˆ° ${chineseSentences.length} ä¸ªä¸­æ–‡å¥å­<br>
                æç¤º: è¿™æ˜¯ç¤ºä¾‹æ•°æ®ã€‚è¦ä½¿ç”¨è‡ªå·±çš„æ•°æ®ï¼Œè¯·ä¸Šä¼ Excelæ–‡ä»¶æˆ–è¾“å…¥URLã€‚
            `;
            fileInfo.style.display = 'block';
            fileInfo.style.backgroundColor = '#e6f7ff';
            fileInfo.style.borderLeftColor = '#1890ff';
            
            // é‡ç½®ç»ƒä¹ çŠ¶æ€
            currentIndex = 0;
            score = 0;
            results = [];
            
            // æ˜¾ç¤ºç¿»è¯‘åŒºåŸŸ
            translationArea.style.display = 'block';
            resultArea.style.display = 'none';
            resultsSummary.style.display = 'none';
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            updateProgress();
            
            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªå¥å­
            showCurrentSentence();
        }
        
        // æ˜¾ç¤ºURLæµ‹è¯•ç»“æœ
        function showUrlTestResult(message, type) {
            urlTestResult.innerHTML = message;
            urlTestResult.className = `url-test-result url-test-${type}`;
            urlTestResult.style.display = 'block';
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 'æœªçŸ¥') return 'æœªçŸ¥';
            const b = parseInt(bytes);
            if (b === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(b) / Math.log(k));
            return parseFloat((b / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(isLoading) {
            loading.style.display = isLoading ? 'block' : 'none';
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            errorMessage.innerHTML = message;
            errorMessage.style.display = 'block';
        }
        
        // éšè—é”™è¯¯ä¿¡æ¯
        function hideError() {
            errorMessage.style.display = 'none';
        }
        
        // æ˜¾ç¤ºå½“å‰å¥å­
        function showCurrentSentence() {
            if (currentIndex < chineseSentences.length) {
                currentSentence.textContent = chineseSentences[currentIndex];
                translationInput.value = '';
                resultArea.style.display = 'none';
                
                // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                updateProgress();
                
                // è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
                translationInput.focus();
            } else {
                // æ‰€æœ‰å¥å­å·²å®Œæˆï¼Œæ˜¾ç¤ºç»“æœæ€»ç»“
                showResultsSummary();
            }
        }
        
        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            currentIndexElement.textContent = currentIndex + 1;
            totalSentencesElement.textContent = chineseSentences.length;
            scoreElement.textContent = score;
            
            const progressPercent = ((currentIndex + 1) / chineseSentences.length) * 100;
            progressFill.style.width = `${Math.min(progressPercent, 100)}%`;
        }
        
        // æäº¤ç¿»è¯‘
        submitBtn.addEventListener('click', () => {
            const userTranslation = translationInput.value.trim();
            
            if (!userTranslation) {
                alert('è¯·è¾“å…¥è‹±æ–‡ç¿»è¯‘');
                return;
            }
            
            const correctAnswer = englishAnswers[currentIndex] || '';
            const isCorrect = compareTranslations(userTranslation, correctAnswer);
            
            // è®°å½•ç»“æœ
            results.push({
                chinese: chineseSentences[currentIndex],
                userTranslation: userTranslation,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            });
            
            // æ›´æ–°åˆ†æ•°
            if (isCorrect) {
                score++;
            }
            
            // æ˜¾ç¤ºç»“æœ
            showResult(isCorrect, userTranslation, correctAnswer);
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            updateProgress();
        });
        
        // ä¸‹ä¸€ä¸ªå¥å­
        nextBtn.addEventListener('click', () => {
            currentIndex++;
            showCurrentSentence();
        });
        
        // æ¯”è¾ƒç¿»è¯‘
        function compareTranslations(user, correct) {
            if (!correct) return false;
            
            const userNormalized = user.toLowerCase().replace(/\s+/g, ' ').trim();
            const correctNormalized = correct.toLowerCase().replace(/\s+/g, ' ').trim();
            
            return userNormalized === correctNormalized;
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(isCorrect, userTranslation, correctAnswer) {
            resultArea.className = isCorrect ? 'result-area correct' : 'result-area incorrect';
            
            let resultHTML = '';
            if (isCorrect) {
                resultHTML = `
                    <div class="result-title">âœ… ç¿»è¯‘æ­£ç¡®ï¼</div>
                    <p>æ‚¨çš„ç¿»è¯‘: <span class="user-translation">${userTranslation}</span></p>
                `;
            } else {
                resultHTML = `
                    <div class="result-title">âŒ ç¿»è¯‘ä¸æ­£ç¡®</div>
                    <p>æ‚¨çš„ç¿»è¯‘: <span class="user-translation">${userTranslation}</span></p>
                    <p>å‚è€ƒç­”æ¡ˆ: <span class="correct-translation">${correctAnswer || 'ï¼ˆæ— å‚è€ƒç­”æ¡ˆï¼‰'}</span></p>
                `;
            }
            
            resultArea.innerHTML = resultHTML;
            resultArea.style.display = 'block';
        }
        
        // æ˜¾ç¤ºç»“æœæ€»ç»“
        function showResultsSummary() {
            translationArea.style.display = 'none';
            resultsSummary.style.display = 'block';
            
            const correctCountValue = results.filter(r => r.isCorrect).length;
            const totalCountValue = results.length;
            const incorrectCountValue = totalCountValue - correctCountValue;
            const finalScoreValue = totalCountValue > 0 ? Math.round((correctCountValue / totalCountValue) * 100) : 0;
            
            correctCount.textContent = correctCountValue;
            incorrectCount.textContent = incorrectCountValue;
            totalCount.textContent = totalCountValue;
            finalScore.textContent = `${finalScoreValue}%`;
            
            let scoreComment = '';
            if (finalScoreValue >= 90) {
                scoreComment = 'å¤ªæ£’äº†ï¼æ‚¨çš„è‹±æ–‡ç¿»è¯‘æ°´å¹³éå¸¸å‡ºè‰²ï¼';
            } else if (finalScoreValue >= 70) {
                scoreComment = 'ä¸é”™ï¼æ‚¨çš„è‹±æ–‡ç¿»è¯‘æ°´å¹³è‰¯å¥½ï¼Œè¿˜æœ‰æå‡ç©ºé—´ã€‚';
            } else if (finalScoreValue >= 50) {
                scoreComment = 'è¿˜å¯ä»¥ï¼Œç»§ç»­åŠªåŠ›æå‡è‹±æ–‡ç¿»è¯‘æ°´å¹³ã€‚';
            } else {
                scoreComment = 'éœ€è¦å¤šåŠ ç»ƒä¹ ï¼Œç»§ç»­åŠªåŠ›ï¼';
            }
            
            scoreText.textContent = scoreComment;
        }
        
        // é‡æ–°å¼€å§‹
        restartBtn.addEventListener('click', () => {
            currentIndex = 0;
            score = 0;
            results = [];
            
            translationArea.style.display = 'block';
            resultsSummary.style.display = 'none';
            
            showCurrentSentence();
        });
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            currentSentence.textContent = "æ¬¢è¿ä½¿ç”¨ä¸­è‹±æ–‡ç¿»è¯‘ç»ƒä¹ å·¥å…·ï¼è¯·é€‰æ‹©æ•°æ®æºå¼€å§‹ç»ƒä¹ ã€‚";
        });
    </script>
</body>
</html>